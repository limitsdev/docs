---
title: "Policies"
description: "Evaluate policies with check() and evaluate()"
---

The Limits SDK provides two methods to evaluate policies:

1. **`check(policyKey, input)`** — for **Conditions mode** policies (structured data or interaction text).
2. **`evaluate(policyKey, prompt, response)`** — for **Instructions mode** policies (AI agent responses against natural-language rules).

## Method: `check(policyKey, input)`

**Signature**

```typescript
async check(
  policyKey: string,
  input: Record<string, unknown> | string
): Promise<PolicyEvaluationResult>
```

| Parameter   | Type                                | Required | Description |
|------------|--------------------------------------|----------|-------------|
| `policyKey`| `string`                             | **Yes**  | Policy identifier (e.g. `amount-minimum-usd`, `interaction-amount-minimum-usd`). Non-empty. |
| `input`    | `Record<string, unknown>` or `string`| **Yes**  | Either a **conditions object** or **interaction text**. |

**Returns:** `Promise<PolicyEvaluationResult>`. See [Response shape](#policy-evaluation-result) below.

**Throws**

- `InvalidPolicyKeyError` — empty or invalid `policyKey`.
- `InvalidInputError` — empty object, empty string, or invalid type.
- `APIRequestError` — API returned 4xx/5xx.
- `NetworkError` — connection/DNS/network failure.

---

## Using `check` with conditions (object)

Send a **non-empty object** as `input`. The SDK sends it as `request` in the body.

```typescript
const result = await limits.check('amount-minimum-usd', {
  amount: 500,
  currency: 'USD',
  customerId: 'cus_123',
});

if (result.isBlocked) {
  console.error('Blocked:', result.data.reason);
  if (result.errors?.length) {
    result.errors.forEach((e) => console.error(' -', e));
  }
} else if (result.isEscalated) {
  console.warn('Escalated:', result.data.reason);
} else {
  console.log('Allowed:', result.data.reason);
}
```

**Internal request**

- **URL:** `POST https://api.limits.dev/api/policies/{policyKey}/evaluate`
- **Body:** `{ "request": { ...your object } }`

---

## Using `check` with interaction text (string)

Send a **non-empty string** (e.g. LLM/agent response). The SDK sends it as `response.text` in the body.

```typescript
const result = await limits.check(
  'block-amount-under-9000',
  'Acknowledged. I tried to submit your payment for Order ORD-938271. Amount received: 300.00 USD using method: card_visa_ending_1442.'
);

if (result.isBlocked) {
  console.error('Interaction blocked:', result.data.reason);
}
```

**Internal request**

- **URL:** `POST https://api.limits.dev/api/policies/{policyKey}/evaluate`
- **Body:** `{ "response": { "text": "<your string>" } }`

---

## Method: `evaluate(policyKey, prompt, response)`

Use `evaluate()` for **Instructions mode** policies. Pass the user's prompt and your AI agent's response. Limits evaluates the response against the natural-language instructions defined in your policy.

**Signature**

```typescript
async evaluate(
  policyKey: string,
  prompt: string,
  response: any
): Promise<PolicyEvaluationResult>
```

| Parameter   | Type     | Required | Description |
|-------------|----------|----------|-------------|
| `policyKey` | `string` | **Yes**  | Policy identifier. |
| `prompt`    | `string` | **Yes**  | The user's original prompt to your AI agent. |
| `response`  | `any`    | **Yes**  | Your AI agent's response to be evaluated. |

**Example**

```typescript
// User asks your AI agent to draft an email
const prompt = 'Write a professional email to our client about the project delay';
const agentResponse = {
  text: 'Dear Client, I regret to inform you that our project timeline has shifted. We expect a 2-week delay due to unforeseen technical challenges. We apologize for any inconvenience.'
};

// Evaluate against policy instructions
// (e.g., "Block if the email contains apologies or admits fault")
const result = await limits.evaluate('email-compliance-policy', prompt, agentResponse);

if (result.isBlocked) {
  console.error('Response blocked:', result.data.reason);
} else if (result.isEscalated) {
  console.warn('Escalated for review:', result.data.reason);
} else {
  console.log('Allowed:', result.data.reason);
}
```

**Internal request**

- **URL:** `POST https://api.limits.dev/api/policies/{policyKey}/evaluate`
- **Body:** `{ "text": "<prompt>", "response": <response> }`

---

## Policy evaluation result

Both `check()` and `evaluate()` return a `PolicyEvaluationResult`:

| Field          | Type     | Description |
|----------------|----------|-------------|
| `data`        | `object` | Always present. |
| `data.action` | `'allow' \| 'block' \| 'escalate'` | Decision. |
| `data.reason` | `string` | Human-readable reason. |
| `isAllowed`   | `boolean`| `data.action === 'allow'`. |
| `isBlocked`   | `boolean`| `data.action === 'block'`. |
| `isEscalated` | `boolean`| `data.action === 'escalate'`. |
| `errors`      | `string[] \| undefined` | Validation errors from the API (e.g. missing parameters). Present when the API returns `meta.errors`. |

**Example (allowed)**

```json
{
  "data": {
    "action": "allow",
    "reason": "Transaction amount is within allowed limits"
  },
  "isAllowed": true,
  "isBlocked": false,
  "isEscalated": false
}
```

**Example (blocked with validation errors)**

```json
{
  "data": {
    "action": "block",
    "reason": "Parameter validation failed"
  },
  "isAllowed": false,
  "isBlocked": true,
  "isEscalated": false,
  "errors": [
    "Missing required parameter: 'currency' in request",
    "Missing required parameter: 'customer_id' in request"
  ]
}
```

---

## Error handling

All SDK errors extend `LimitsSDKError`. Use `instanceof` for handling.

| Error class             | When it is thrown |
|-------------------------|--------------------|
| `InvalidAPIKeyError`    | Invalid or missing API key (e.g. doesn't start with `sk_`). |
| `InvalidPolicyKeyError` | Empty or invalid `policyKey` in `check()`. |
| `InvalidInputError`     | Invalid `input` in `check()` (empty object/string) or invalid UUID in approve/decline. |
| `APIRequestError`       | API returned 4xx or 5xx. |
| `NetworkError`          | Connection/DNS/network failure. |
| `TimeoutError`          | Request timeout (if used with custom fetch/timeout logic). |

**APIRequestError** has: `message`, `statusCode?`, `response?` (API body: `{ statusCode, message }`).

```typescript
import {
  Limits,
  APIRequestError,
  NetworkError,
  InvalidPolicyKeyError,
  InvalidInputError,
} from '@limits/sdk';

try {
  const result = await limits.check('amount-minimum-usd', { amount: 500, currency: 'USD' });
  // use result
} catch (err) {
  if (err instanceof APIRequestError) {
    console.error('API error', err.statusCode, err.response?.message ?? err.message);
  } else if (err instanceof NetworkError) {
    console.error('Network error', err.message, err.originalError);
  } else if (err instanceof InvalidPolicyKeyError || err instanceof InvalidInputError) {
    console.error('Invalid input:', err.message);
  } else {
    throw err;
  }
}
```

---

## Full flow example

```typescript
import { Limits, APIRequestError, NetworkError } from '@limits/sdk';

const limits = new Limits({ apiKey: process.env.LIMITS_API_KEY! });

async function evaluateTransaction(amount: number, currency: string) {
  try {
    const result = await limits.check('amount-minimum-usd', { amount, currency });

    if (result.isBlocked) {
      console.error('Blocked:', result.data.reason);
      if (result.errors?.length) result.errors.forEach((e) => console.error('  -', e));
      return { allowed: false, reason: result.data.reason };
    }

    if (result.isEscalated) {
      console.warn('Escalated for review:', result.data.reason);
      return { allowed: 'review', reason: result.data.reason };
    }

    return { allowed: true, reason: result.data.reason };
  } catch (e) {
    if (e instanceof APIRequestError) console.error('API error', e.statusCode, e.message);
    else if (e instanceof NetworkError) console.error('Network error', e.message);
    throw e;
  }
}
```

## Next Steps

<CardGroup cols={2}>
  <Card title="Human Approvals" icon="user-check" href="/sdk/escalations">
    List, approve, and decline human approval requests.
  </Card>
  <Card title="Platform Policies" icon="layout" href="/platform/policies">
    Create and manage policies in the web interface.
  </Card>
</CardGroup>
